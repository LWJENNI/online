<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Розклад</title>
    <style>
        body {
            background-color: rgb(80, 141, 165);
        }

        .container {
            margin-top: 20px;
        }

        .dynamic-div {
            width: 100%;
            border-collapse: collapse;
        }

        .dynamic-div th,
        .dynamic-div td {
            padding: 10px;
            text-align: center;
            font-size: 20px;
        }

        .dynamic-div th {
            background-color: rgb(53, 157, 198);
            border-radius: 20px;
            border-bottom-left-radius: 0px;
            border-bottom-right-radius: 0px;
        }

        #schedule {
            border: solid rgb(53, 157, 198);
        }

        select {
            background-color: rgb(35, 193, 207);
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>

<body>
    <main>
        <div
            style="background-color: rgb(22, 148, 198); border-radius: 25px; border: solid rgb(15, 106, 142); text-align: center; display: list-item;">
            <select name="date" id="date" style="margin: 10px 10px; ">
                <option value="all-days" selected>Всі дні</option>
                <option value="Monday">Понеділок</option>
                <option value="Tuesday">Вівторок</option>
                <option value="Wednesday">Середа</option>
                <option value="Thursday">Четвер</option>
                <option value="Friday">П'ятниця</option>
            </select>
            <div class="version" id="version" style="background-color: rgb(22, 148, 198);">

            </div>
        </div>
    </main>
    <aside>
        <div class="container" id="schedule"
            style="background-color: rgb(15, 106, 142); border-radius: 25px; text-align: center;"></div>
    </aside>
    <footer>
        <div
            style="position: fixed; bottom: 20px; left: 50%; margin: 0px -130px; background-color: rgba(27, 96, 124, 0.5); padding: 10px; border-radius: 5px; z-index: 1000;">
            Це не фінальний результат, <br> і розклад може бути змінений.
        </div>
        <br>
        <br>
        <br>
        <br>
    </footer>
    <article>
        <div style="background-color: rgb(8, 96, 104); text-align: center; width: 35%;">
            Info
            <div id="info" class="info">

            </div>
        </div>
    </article>

    <script>
        let lists;
    
        function finish(data) {
            return new Promise((resolve, reject) => {
                const version = data.version;
                const currentDate = new Date();
                const formattedCurrentDate = currentDate.toISOString().slice(0, 10).replace(/-/g, '.');
    
                console.log("Current Formatted Date:", formattedCurrentDate);
    
                const startDate = data.date[0];
                const endDate = data.date[1];
    
                if (formattedCurrentDate >= startDate && formattedCurrentDate <= endDate) {
                    lists = data.list;
                    console.log("patch:", version);
                    document.getElementById("version").innerHTML = "<p>Version Patch: " + version + "<br>Date: " + formattedCurrentDate + "</p>";

                    console.log("Current Date is in range. Lists:", lists);
                    resolve(lists);
                    const size = lists.length;
                    document.getElementById("info").innerHTML = "date: " + startDate + " " + endDate + " " + formattedCurrentDate + "<br> patch: " + version + "<br> Size L: " + size;
                } else {
                    console.log("Current Date is out of range.");
                    reject("Current Date is out of range.");
                }
            });
        }
    
    
        const send = 'https://raw.githubusercontent.com/LWJENNI/online/main/date.json';
    
        fetch(send)
            .then(response => response.json())
            .then(data => finish(data))
            .then(() => {
                main();
            })
            .catch(error => console.error(error));
        function main() {
            document.getElementById('date').addEventListener('change', updateContent);
            function updateContent() {
                const dayValue = document.getElementById('date').value;
                createScheduleTable(dayValue);
            }
            function createScheduleTable(dayName) {
                const schedule = lists[0].class7;
                let result = "<table class='dynamic-div'><tr><th>День тижня</th><th>Час</th><th>Урок</th></tr>";
    
                if (dayName === "all-days") {
                    for (const [day, lessons] of Object.entries(schedule)) {
                        let lastTime = ""; 
                        for (const lesson of lessons) {
                            if (lesson.time === lastTime) {
                                result += `<tr><td></td><td>${lesson.time}</td><td>${lesson.text}</td></tr>`;
                            } else {
                                result += `<tr><td>${day}</td><td>${lesson.time}</td><td>${lesson.text}</td></tr>`;
                            }
                            lastTime = lesson.time;
                        }
                    }
                } else if (schedule[dayName]) {
                    const lessons = schedule[dayName];
                    for (const lesson of lessons) {
                        result += `<tr><td>${dayName}</td><td>${lesson.time}</td><td>${lesson.text}</td></tr>`;
                    }
                } else {
                    result += `<tr><td colspan="3">Дані не знайдено для ${dayName}</td></tr>`;
                }
    
                result += "</table>";
                document.getElementById("schedule").innerHTML = result;
            }
            createScheduleTable("all-days");
        }
    </script>
    
</body>

</html>